# Домашнее задание к занятию "6.1. Типы и структура СУБД"

## Введение

Перед выполнением задания вы можете ознакомиться с 
[дополнительными материалами](https://github.com/netology-code/virt-homeworks/tree/master/additional/README.md).

## Задача 1

Архитектор ПО решил проконсультироваться у вас, какой тип БД 
лучше выбрать для хранения определенных данных.

Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:

- Электронные чеки в json виде
- Склады и автомобильные дороги для логистической компании
- Генеалогические деревья
- Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации
- Отношения клиент-покупка для интернет-магазина

Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.
  
### Решение (по материалам лекции)
  
  - *Электронные чеки в json виде*: ***Документо-ориентированная*** (`Каждый документ представляет данные в виде "ключ-значение"`)
  
  - *Склады и автомобильные дороги для логистической компании*: ***Сетевая*** (`...сетевой узел может иметь отношения с несколькими объектами.`)
  
  - *Генеалогические деревья*: ***Иерархическая*** - (`В иерархической модели данные организованы в древовидную структуру.`)

  - *Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации*: ***Ключ-значение*** ( похоже на структуру "id клиента" - "уровень доступа (роль)")
  
  - *Отношения клиент-покупка для интернет-магазина*: ***Реляционная*** - (Определены два множества - `Клиенты` и `Товары (услуги)`, связанных между собой отношениями `Покупки`, Оба множества удобно хранить в таблицах, а для обработки использовать SQL)
  
## Задача 2

Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно 
CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если 
(каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):

- Данные записываются на все узлы с задержкой до часа (асинхронная запись)
- При сетевых сбоях, система может разделиться на 2 раздельных кластера
- Система может не прислать корректный ответ или сбросить соединение

А согласно PACELC-теореме, как бы вы классифицировали данные реализации?
  
### Решение
  
*- Данные записываются на все узлы с задержкой до часа (асинхронная запись)*  
Без указания архитектуры приложения – вообще не понятно. При сетевом разделении система будет доступна? А скорость ответа на запросы пользователей какая?  
По CAP: Если система Active (Master) -> Passive (Replica), то просто "С" с улучшенными возможностями по восстановлению после сбоя (ближе к CA), т.к. есть точка отказа – Master, но он точно всегда консистентен, т.к. сам пишет и сам отвечает (пока не «упадёт»). Если клиенты могут читать с реплики, то задержка «до часа» убирает консистентность и система вообще не будет CAP-совместимой (падение мастера полностью выключит запись == отказ в обслуживании).  
Если система Multy-master, т.е. пишут и отвечают все узлы – то ближе к AP, т.к. вряд ли высоконагруженное приложение будет блокировать транзакцию до времени синхронизации и, таким образом, консистентности не будет (ближе к варианту следующей задачи).  
  
*По PACELC:*  Если исходить из того, что L – это «до часа», то это PC/EC (паление связи с пассивной репликой), либо PA/EC (падение связи отключает часть кластера и часть данных «подвисают в отключке», но то, что прошло синхронизацию будет консистентным), иначе – вариант из второго задания.  

*- При сетевых сбоях, система может разделиться на 2 раздельных кластера* - ***  

*По CAP:* - «AP», т.к. система продолжает работать после разделения и её части продолжают обслуживать запросы. "С" - точно нет (разные наборы данных в разных кластерах)  
*По PACELC*  - «PA/EL», т.к. скорее всего задержки при разделении вырастут незначительно, а изначально это AP-система.  

*- Система может не прислать корректный ответ или сбросить соединение* -  

*По CAP:* - Если система продолжит генерировать ответы до последнего живого узла – то будет «чистое A». Если система продолжит работать после разделения и её части продолжают обслуживать запросы, то – «AP». "С" - точно нет (ответы могут различаться при одинаковых запросах к одинаковым наборам данных).  
Однако второе условие усугубляет ситуацию, т.к. соединения могут сбрасываться неопределённо долгое время (т.е. система теряет и доступность («А») и устойчивость к распределению «P»). Т.е. по факту – это чистый отказ в обслуживании («ничего» по CAP).  
*По PACELC* - «PA/EL», т.к. точно не C, а изначально AP (A)  

## Задача 3

Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?
  
### Решение
  
*Могут ли в одной системе сочетаться принципы BASE и ACID?* 
***Не могут.***
> > BASE - принцип, противопоставляющий себя ACID
  
*Почему?* - ***ACID - гарантирует согласованность данных, а BASE - доступность***
> > Система отвечает на любой запрос, но в ответе могут быть неверные данные.  

## Задача 4

Вам дали задачу написать системное решение, основой которого бы послужили:

- фиксация некоторых значений с временем жизни
- реакция на истечение таймаута

Вы слышали о key-value хранилище, которое имеет механизм [Pub/Sub](https://habr.com/ru/post/278237/). 
Что это за система? Какие минусы выбора данной системы?
  
### Решение
  
*Что это за система?*  - ***REDIS***  
  
*Какие минусы выбора данной системы?*  
  
- Актуальные данные находятся в RAM. При аварийной остановке могут быть утрачены данные, изменившиеся за время после последней синхронизации с диском.    
- Высокая стоимость единицы хранения, т.к. требуется достаточное количество свободного места в памяти (самое дорогое хранилище в сервере).  
- NoSQL дизайн. Не минус, но стоит учитывать особенности.  
  
---

