# Домашнее задание к занятию "5.1. Основы виртуализации"

## Задача 1

Вкратце опишите, как вы поняли - в чем основное отличие паравиртуализации и виртуализации на основе ОС.Опишите кратко, как вы поняли: в чем основное отличие полной (аппаратной) виртуализации, паравиртуализации и виртуализации на основе ОС.  

### Решение:  

**Полная (аппаратная) виртуализация** - Виртуализация на уровне устройств. Гостевые ВМ работают каждая со своим отдельным экземпляром ядра ОС (ОС могут быть разные и не требуют изменения для запуска в виртуальном окружении), которое общается с аппаратными средствами хоста через виртуальные устройства, эмулируемыми гипервизором работающим напрямую с аппаратным обеспечением хоста.    
**Паравиртуализация** – Виртуализация с использованием API для доступа к ресурсам хоста через хостовую ОС поверх которой запущен гипервизор.  
Каждая гостевая ВМ представлена в виде отдельного процесса на хостовой ОС и работает с отдельным экземпляром ядра ОС (ОС на ВМ могут быть разные), но такие ядра должны быть модифицированы для поддержки запуска в режиме паравиртуализации.  
**Виртуализации на основе ОС** – это метод изоляции виртуальных сред (контейнеров) на основе единой ОС и окружения ядра. При этом типе виртуализации единое для всех контейнеров ядро операционной системы поддерживает несколько изолированных экземпляров пространства пользователя для запуска в них относительно независимых вариантов программного кода (сервисов).  

## Задача 2

Выберите тип один из вариантов использования организации физических серверов, 
в зависимости от условий использования.

Организация серверов:
- физические сервера
- паравиртуализация
- виртуализация уровня ОС

Условия использования:

- Высоконагруженная база данных, чувствительная к отказу
- Различные Java-приложения
- Windows системы для использования Бухгалтерским отделом 
- Системы, выполняющие высокопроизводительные расчеты на GPU

Опишите, почему вы выбрали к каждому целевому использованию такую организацию.

### Решение:  

**•	Высоконагруженная база данных, чувствительная к отказу** – Кластер из физических серверов или хостов с виртуализацией уровня ОС, т.к. это решение позволяет не терять производительность на виртуализацию систем ввода-вывода и при этом устранить простой при недоступности одного из серверов кластера (плановой или аварийной остановке сервиса)  

**•	Различные Java-приложения** - виртуализация уровня ОС, т.к. это решение позволяет изолировать среды исполнения кода не теряя производительности для приложений и позволяет сократить затраты ресурсов на саму виртуализацию (т.к. используется единое ядро ОС).

**•	Windows системы для использования Бухгалтерским отделом** – Зависит от схемы работы приложений, но в общем случае имеет смысл ориентироваться на паравиртуализацию на основе ОС Windows Server с ролью Hyper-V. Отказоустойчивость можно обеспечить кластеризацией хостов или настройкой репликации экземпляров ВМ между хостами.  
        Основными преимуществами такого решения считаю:  
        -	Консолидацию систем с уплотнением размещения повышением утилизации ресурсов, т.к. обычно такие системы работают в режиме частичных нагрузок.  
        -	Нативную поддержку гостевых ВМ хостами на основе Hyper-V.  
        -	Отсутствие необходимости поддержки других ОС, как следствие снижение требований к административному персоналу ИТ.  
        -	Возможность реализации всего стека технологий (включая мониторинг, управление ВМ и архивацию) на основе продуктов одного вендора, что может упростить развёртывание и поддержку системы.   
        -	Экономию на лицензиях на ОС.  

**•	Системы, выполняющие высокопроизводительные расчеты на GPU** – физические сервера, т.к. для наиболее полной реализации возможностей GPU желательно виртуализацию не использовать.
При необходимости обеспечения требований к непрерывности процесса при отсутствии таких возможностей на уровне приложения можно рассмотреть реализацию на основе систем с поддержкой проброса аппаратных ресурсов внутрь ВМ и последующей миграцией таких ВМ средствами гипервизоров.

## Задача 3

Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.  
Сценарии:  
1.	100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.  
2.	Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.  
3.	Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры.  
4.	Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.  

### Решение:  

1. *100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.*  

Вариант выбора: Hyper-V от Microsoft. 

Преимущества:  
•	Нативная поддержка ОС Windows на гостевых ВМ.  
•	Живая миграция, кластеризация, балансировка и репликация «из коробки». Возможность реализации гиперконвергентной среды от одного вендора.  
•	Экономия на лицензиях. Возможность развёртывания двух ВМ с Windows server на каждую лицензию Standard, или безлимитные лицензии при выборе Datacenter  
•	Широкая поддержка аппаратных средств.  
•	Есть поддержка Linux службами интеграции.  
•	Экономия на обслуживающем персонале.  

Недостатки:  
•	Использование одинаковых ОС на хосте и в гостевых ОС повышает требования к информационной безопасности, т.к. зловредное ПО попав на гостевые ВМ может распространиться и на хостовые ОС.  
•	Не оптимальная работа ВМ с ОС Linux  
•	Расширение инфраструктуры потребует дополнительного лицензирования.  

Альтернатива: VMware vSphere  

Преимущества:  
•	Скорость и стабильность работы  
•	Корпоративная поддержка  
•	Возможность реализации гиперконвергентной среды от одного вендора.  

Недостатки:  
•	Это реально дорого. Каждая «фича» лицензируется отдельно, и в результате получаются весьма значительные затраты на лицензирование, особенно в подписочной модели.  
•	Повышенные требования к административному персоналу.  
•	Ограничения по HAL довольно значительные. Подойдёт далеко не всё оборудование.  

2. *Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин*  

KVM или Xen в редакции Open Source.  

Преимущества:  
•	Бесплатно  
•	Open Source  
•	Хорошая производительность и стабильность работы (для Linux).  

Недостатки:
•	Windows – Требует отдельного лицензирования. Работает с заметными (но не критичными) потерями производительности.  
•	Требования к персоналу выше чем при работе с продуктами Microsoft или VMware.  
•	Поддержка продукта в основном силами сообщества, что не гарантирует результат.  

3. Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры.  

Hyper-V server 2019  

Преимущества:  
•	Бесплатно  
•	Нативная поддержка ОС Windows на гостевых ВМ.  

Недостатки:  
•	Требуется отдельная ОС не ниже Windows 10 или Windows Server 2019 для развёртывания инструментов управления.  
•	Потребуется отдельное лицензирование для гостевых ОС.  

Альтернатива:  

Если количество гостевых систем с ОС Windows Server будет в два и более раза больше чем количество хостов, то возможно использование полноценного дистрибутива Windows Server (в том числе версии 2022). За счёт особенностей лицензирования хостовые ОС могут оказаться условно «бесплатными» (нужно считать ядра процессоров и стоимость лицензий к ним). 

4. Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.

KVM или Xen в редакции Open Source.  

Преимущества:  
•	Бесплатно, Open Source  
•	Хорошая производительность и стабильность работы гостевых ВМ с ОС Linux. 

Недостатки:  
•	Требования к персоналу выше чем при работе с продуктами Microsoft или VMware  
•	Поддержка продукта в основном силами сообщества, что не гарантирует результат  

Альтернатива: Citrix Hypervisor, VMware vSphere  

Преимущества:  
•	Стабильность и скорость работы  
•	Корпоративная поддержка  

Недостатки:  
•	Стоит денег (особенно VMware)  
•	Требует подготовленного административного персонала  

## Задача 4
Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, то создавали бы вы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.  

### Решение:  

#### Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно)
*Проблемы и недостатки гетерогенной среды виртуализации:*  
1. Гетерогенные среды труднее в освоении для административного персонала. Операционные расходы на администрирование таких сред будут выше, чем при использовании гомогенных систем.   
2. Увеличение объёма документации на процессы и методы работы с гетерогеннными средами (под каждый процесс – свой комплект документов).  
3. Увеличение потребности в оборудовании, особенно с обеспечением избыточности (на каждую систему нужен свой отдельный резерв).  
4. Повышаются риски появления инцидента в части информационной безопасности (чем больше кода, тем больше потенциальных ошибок).  
5. Сложности при миграции ресурсов между сегментами среды (это условный недостаток).  
6. Дополнительные сложности при лицензировании сред и продуктов.  

#### Что необходимо сделать для минимизации этих рисков и проблем:
1. Разумно минимизировать список используемых продуктов. 
2. При внедрении нового продукта оценивать его, в том числе на совместимость с уже используемыми технологиями и при необходимости убирать «дубли», если разница между ними незначительна.  
3. Разделять персонал по признаку работы с определённым набором продуктов/технологий. Резервировать функционал. Избегать появления «уникальных специалистов»  
4. Регулярно оценивать набор используемых технологий на предмет соответствия целям и задачам бизнеса с принятием решения на упрощение сред.  

#### Если бы у вас был выбор, то создавали бы вы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.  
Создание гетерогенной среды возможно при явных преимуществах одного из решений и понимании, что внедрённое решение будет работать достаточно долго.  

Например, виртуализация на базе Hyper-V весьма привлекательна при условии наличия большого количества ВМ c ОС Windows (например, для работы бухгалтерии и т.д.) и в то же время, для работы разработчиков удобно развернуть среду виртуализации на основе Linux и Docker. А для реализации удалённой работы с использованием технологии VDI воспользоваться решениями от VMware или Citrix.
При этом нужно понимать, что несмотря на общее для всех примеров использование технологий виртуализации это три разных решения и они могут быть оправданы с точки зрения приобретения ценности в стабильности и производительности в ущерб стоимости внедрения и администрирования.
Таким образом использование гетерогенных сред виртуализации возможно, но при чётком понимании преимуществ и недостатков такого решения.


